# 手机号注册功能使用指南

## 📱 功能概述

智语 App 现已支持手机号注册功能，为用户提供更便捷的注册方式。用户可以选择使用邮箱或手机号进行注册，享受同样完整的应用功能。

## 🚀 快速开始

### 1. 选择注册方式

在登录界面，您可以看到以下选项：
- **邮箱注册**：传统的邮箱注册方式
- **使用手机号注册**：新增的手机号注册方式

### 2. 手机号注册流程

#### 步骤 1：填写注册信息
- **手机号**：输入11位中国大陆手机号（自动格式化显示）
- **用户名**：设置您的用户名（至少2个字符）
- **姓名**：可选，填写您的真实姓名
- **密码**：设置密码（至少6位）
- **确认密码**：再次输入密码确认

#### 步骤 2：获取验证码
- 点击"获取验证码"按钮
- 系统会向您的手机发送6位数字验证码
- 请注意查收短信

#### 步骤 3：验证手机号
- 输入收到的6位验证码
- 点击"验证并注册"完成注册
- 注册成功后自动登录

## 🔧 功能特性

### ✅ 智能验证
- **手机号格式验证**：自动检查手机号格式是否正确
- **实时格式化**：输入时自动格式化为 "138 0013 8000" 形式
- **密码强度检查**：确保密码安全性

### ✅ 验证码管理
- **6位数字验证码**：标准的短信验证码格式
- **60秒冷却时间**：防止频繁发送，保护用户体验
- **重发功能**：支持重新发送验证码
- **倒计时显示**：清晰显示剩余等待时间

### ✅ 用户体验
- **美观界面**：专门设计的手机号注册界面
- **流程指引**：清晰的步骤提示
- **错误处理**：友好的错误提示信息
- **返回功能**：可随时返回修改信息

## 🛠️ 技术说明

### 支持的手机号格式
- **中国大陆手机号**：1[3-9]xxxxxxxxx
- **自动添加区号**：系统自动添加 +86 区号
- **格式化显示**：138 0013 8000 格式

### 验证码规则
- **验证码长度**：6位数字
- **有效期**：通常为5-10分钟（具体由SMS服务商决定）
- **重发限制**：60秒内只能发送一次

### 安全机制
- **数据加密**：所有数据传输采用 HTTPS 加密
- **用户隔离**：每个用户只能访问自己的数据
- **验证码保护**：验证码仅发送到用户手机，不在客户端存储

## 📋 配置要求

### 管理员配置
如果您是应用管理员，需要完成以下配置：

1. **Supabase 配置**：
   - 启用手机号认证
   - 配置 SMS 服务商（推荐 Twilio）
   - 设置合理的发送频率限制

2. **数据库更新**：
   - 运行 `supabase-phone-auth-setup.sql` 脚本
   - 确保用户表支持手机号字段

3. **SMS 服务商**：
   - 注册 Twilio 账户（推荐）
   - 获取 Account SID 和 Auth Token
   - 配置发送号码

### 中国大陆用户特别说明
由于网络环境限制，建议：
- 使用国内 SMS 服务商（阿里云短信、腾讯云短信）
- 或配置代理服务器
- 确保网络连接稳定

## 🔍 常见问题

### Q: 收不到验证码怎么办？
A: 请检查：
- 手机号是否输入正确
- 手机信号是否正常
- 是否被手机安全软件拦截
- 等待60秒后尝试重新发送

### Q: 验证码输入错误怎么办？
A: 
- 请仔细检查验证码是否正确
- 确认验证码是否过期
- 可以重新发送验证码

### Q: 手机号已被注册怎么办？
A: 
- 如果是您的手机号，请直接登录
- 如果忘记密码，可以使用密码重置功能
- 联系客服处理账户问题

### Q: 可以修改绑定的手机号吗？
A: 
- 目前版本暂不支持修改手机号
- 未来版本会添加此功能
- 如需修改，请联系客服

### Q: 手机号注册和邮箱注册有什么区别？
A: 
- 功能完全相同，只是注册方式不同
- 手机号注册更快捷，无需邮箱验证
- 邮箱注册更传统，适合习惯邮箱的用户

## 🎯 最佳实践

### 用户建议
1. **选择合适的注册方式**：
   - 经常使用手机的用户推荐手机号注册
   - 习惯邮箱管理的用户推荐邮箱注册

2. **保护账户安全**：
   - 设置强密码
   - 不要在公共场所输入验证码
   - 定期更新密码

3. **注册信息准确**：
   - 确保手机号输入正确
   - 用户名建议使用易记的名称
   - 保存好账户信息

### 管理员建议
1. **监控发送量**：
   - 定期检查短信发送量
   - 设置合理的费用预警
   - 优化发送频率限制

2. **用户支持**：
   - 准备常见问题解答
   - 提供多种联系方式
   - 及时处理用户反馈

## 📞 技术支持

如果您在使用过程中遇到问题：

1. **查看错误信息**：应用会显示具体的错误提示
2. **检查网络连接**：确保网络连接稳定
3. **重试操作**：大多数问题可以通过重试解决
4. **联系支持**：如果问题持续存在，请联系技术支持

## 🔄 更新计划

### 即将推出的功能
- **手机号登录**：支持使用手机号直接登录
- **手机号修改**：允许用户修改绑定的手机号
- **国际手机号**：支持其他国家和地区的手机号
- **语音验证码**：提供语音验证码选项

### 持续优化
- **界面优化**：持续改进用户界面
- **性能提升**：优化验证码发送速度
- **安全增强**：加强账户安全保护
- **兼容性改进**：支持更多设备和系统

## 权限问题解决方案

### 1. 权限错误："new row violates row-level security policy"

**问题描述**：用户注册时出现 RLS 策略违规错误

**解决方案**：
1. 运行 `supabase-rls-simple-fix.sql` 文件
2. 确保 RLS 策略正确配置
3. 验证用户认证状态

**原因**：用户在认证过程中尝试创建用户记录，但 RLS 策略不允许

**修复后的逻辑**：
- 邮箱注册：先注册认证用户，验证邮箱后自动创建用户记录
- 手机号注册：先注册认证用户，验证手机号后创建用户记录
- 自动创建：`getCurrentUser()` 函数会自动为已认证但无记录的用户创建基础资料

### 2. 短信发送失败

**可能原因**：
- Twilio 配置错误
- 手机号格式不正确
- SMS 服务商账户余额不足
- 网络连接问题

**解决方案**：
1. 检查 Twilio 配置
2. 验证手机号格式
3. 检查账户余额
4. 测试网络连接

### 3. 验证码接收不到

**可能原因**：
- 手机号输入错误
- 短信被拦截
- 服务商延迟

**解决方案**：
1. 确认手机号正确
2. 检查垃圾短信箱
3. 等待几分钟后重试
4. 联系服务商确认

### 4. 中国大陆网络问题

**问题描述**：由于网络限制，可能无法正常使用 Twilio

**解决方案**：
1. 使用国内 SMS 服务商（阿里云、腾讯云）
2. 配置代理服务器
3. 使用 VPN 连接

## 技术实现细节

### 1. 架构设计
```
用户输入 → 格式验证 → Supabase Auth → SMS 发送 → 验证码确认 → 用户记录创建
```

### 2. 核心组件
- `PhoneAuthScreen.tsx`：手机号注册界面
- `AuthService.signUpWithPhone()`：手机号注册逻辑
- `AuthService.verifyPhone()`：验证码验证逻辑
- `AuthService.getCurrentUser()`：自动创建用户记录

### 3. 安全机制
- 手机号格式验证
- 密码强度检查
- 验证码时效控制
- RLS 数据隔离
- 用户会话管理

### 4. 错误处理
- 网络错误重试
- 用户友好的错误提示
- 详细的日志记录
- 优雅的降级处理

## 更新日志

### v2.0.2 (2024-01-XX)
- 实现手机号注册功能
- 修复 RLS 权限问题
- 优化用户体验
- 添加错误处理机制

### v2.0.1
- 基础认证系统
- 邮箱注册功能

## 支持与反馈

如果在使用过程中遇到问题，请：
1. 检查本指南中的常见问题解决方案
2. 查看控制台错误日志
3. 验证 Supabase 配置
4. 联系技术支持

---

*最后更新：2024年1月*
*版本：2.0.2* 