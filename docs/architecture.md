# 项目架构文档

## 整体架构

境语应用采用现代化的 React Native + Expo 架构，基于文件系统的路由方案，具有清晰的代码组织和良好的可维护性。

## 技术架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    用户界面层 (UI Layer)                      │
├─────────────────────────────────────────────────────────────┤
│  app/                    components/                        │
│  ├── (tabs)/            ├── IdiomCard.tsx                  │
│  ├── idiom/             └── ...                            │
│  └── _layout.tsx                                            │
├─────────────────────────────────────────────────────────────┤
│                    业务逻辑层 (Business Logic)                │
├─────────────────────────────────────────────────────────────┤
│  hooks/                  data/                             │
│  ├── useFrameworkReady.ts ├── idioms.ts                    │
│  └── ...                 └── ...                           │
├─────────────────────────────────────────────────────────────┤
│                    数据层 (Data Layer)                       │
├─────────────────────────────────────────────────────────────┤
│  静态数据 (Static Data)    本地存储 (Local Storage)           │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │ 成语数据        │    │ 收藏数据        │                │
│  │ 分类数据        │    │ 用户设置        │                │
│  └─────────────────┘    └─────────────────┘                │
└─────────────────────────────────────────────────────────────┘
```

## 目录结构详解

### 1. 应用页面 (`app/`)

#### 路由结构
```
app/
├── _layout.tsx              # 根布局，配置字体和全局样式
├── +not-found.tsx          # 404 错误页面
├── (tabs)/                 # 底部标签页组
│   ├── _layout.tsx         # 标签页布局配置
│   ├── index.tsx           # 首页 - 成语列表
│   ├── search.tsx          # 搜索页 - 成语搜索
│   ├── favorites.tsx       # 收藏页 - 收藏的成语
│   └── profile.tsx         # 个人页 - 用户信息
└── idiom/                  # 成语详情页
    └── [id].tsx            # 动态路由 - 成语详情
```

#### 路由配置
- **根路由**: 配置全局字体加载和启动屏幕
- **标签路由**: 底部导航栏，包含四个主要功能页面
- **动态路由**: 成语详情页，支持参数传递

### 2. 组件层 (`components/`)

#### 组件设计原则
- **单一职责**: 每个组件只负责一个特定功能
- **可复用性**: 组件设计为可复用的
- **类型安全**: 使用 TypeScript 定义组件接口

#### 核心组件

##### IdiomCard 组件
```typescript
interface IdiomCardProps {
  idiom: Idiom;              // 成语数据
  onPress: () => void;       // 点击事件
  onFavorite?: () => void;   // 收藏事件（可选）
  isFavorited?: boolean;     // 收藏状态（可选）
}
```

**功能特性**:
- 展示成语卡片信息
- 支持收藏功能
- 传统中国风设计
- 响应式布局

### 3. 数据层 (`data/`)

#### 数据结构设计

##### 成语数据模型
```typescript
interface Idiom {
  id: string;                                    // 唯一标识符
  idiom: string;                                 // 成语文本
  pinyin: string;                                // 拼音
  meaning: string;                               // 释义
  origin: string;                                // 出处
  example: string;                               // 例句
  similar: string[];                             // 相似成语列表
  category: string;                              // 分类
  difficulty: 'easy' | 'medium' | 'hard';        // 难度等级
}
```

#### 数据管理策略
- **静态数据**: 成语数据存储在本地文件中
- **状态管理**: 使用 React Hooks 管理组件状态
- **本地存储**: 收藏数据使用本地存储

### 4. 自定义 Hooks (`hooks/`)

#### useFrameworkReady Hook
```typescript
export function useFrameworkReady() {
  useEffect(() => {
    // 框架初始化逻辑
  }, []);
}
```

**用途**: 确保应用框架正确初始化

## 设计模式

### 1. 组件组合模式
- 通过 props 传递数据和回调函数
- 支持组件的灵活组合和复用

### 2. 状态提升模式
- 将共享状态提升到最近的共同父组件
- 通过 props 向下传递状态和更新函数

### 3. 受控组件模式
- 表单输入完全由 React 状态控制
- 确保数据流的一致性和可预测性

## 性能优化策略

### 1. 列表优化
- 使用 `FlatList` 进行虚拟化渲染
- 实现 `keyExtractor` 优化重渲染

### 2. 内存管理
- 及时清理事件监听器
- 避免内存泄漏

### 3. 图片优化
- 使用适当的图片格式和尺寸
- 实现懒加载

## 错误处理

### 1. 边界错误处理
- 使用 Error Boundary 捕获组件错误
- 提供友好的错误提示

### 2. 数据验证
- 对输入数据进行类型检查
- 提供默认值和回退方案

### 3. 网络错误处理
- 处理网络请求失败
- 提供离线功能支持

## 安全性考虑

### 1. 数据安全
- 敏感数据不存储在本地
- 使用安全的存储方式

### 2. 输入验证
- 对用户输入进行验证和清理
- 防止 XSS 攻击

### 3. 权限管理
- 最小权限原则
- 明确权限使用说明

## 可扩展性设计

### 1. 模块化架构
- 清晰的模块边界
- 松耦合的组件设计

### 2. 配置化
- 支持主题配置
- 支持多语言配置

### 3. 插件化
- 支持功能模块的插件化扩展
- 便于添加新功能

## 测试策略

### 1. 单元测试
- 测试核心业务逻辑
- 测试组件渲染

### 2. 集成测试
- 测试页面交互
- 测试数据流

### 3. 端到端测试
- 测试完整用户流程
- 测试跨平台兼容性 